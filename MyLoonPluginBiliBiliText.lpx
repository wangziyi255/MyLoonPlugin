#!name=å“”å“©å“”å“©å¢å¼ºè‡ªç”¨ä¿®æ”¹ç‰ˆ
#!desc=è¿‡æ»¤å“”å“©å“”å“©å¹¿å‘Š
#!author=RuCu6[https://github.com/RuCu6], kokoryh[https://github.com/kokoryh], Maasea[https://github.com/Maasea], å¯è‰ğŸ…¥[https://github.com/luestr/ProxyResource/blob/main/README.md]
#!icon=https://raw.githubusercontent.com/sooyaaabo/Loon/main/Icon/App-Icon/BilibiliPink.png
#!openUrl=https://apps.apple.com/app/id736536022
#!tag=å»å¹¿å‘Š
#!loon_version=3.3.7(921)
#!homepage=https://github.com/sooyaaabo/Loon/blob/main/README.md
#!date=2025-12-16 20:00

[Argument]
displayUpList=select, "auto", "show", "hide",tag = [åŠ¨æ€]ä¸­[æœ€å¸¸è®¿é—®]çš„æ˜¾ç¤ºæ–¹å¼, desc = auto: ä»…å½“åˆ—è¡¨ä¸­å­˜åœ¨ç›´æ’­çŠ¶æ€æ—¶æ˜¾ç¤º; show: å§‹ç»ˆæ˜¾ç¤º; hide: å§‹ç»ˆéšè—;
purifyComment=switch,"false","true",tag = [è¯„è®ºåŒº]è¿‡æ»¤ç½®é¡¶è¯„è®ºå¹¿å‘Š, desc = true: å¼€å¯; false: å…³é—­;
optimizeRequest=switch,"false","true",tag =[è¯„è®ºåŒº]ä¼˜åŒ–åŠ è½½, desc = true: å¼€å¯; false: å…³é—­;
sponsorBlock=switch,"false","true",tag = [ç©ºé™åŠ©æ‰‹]è·³è¿‡è§†é¢‘å†…æ’æ’­å¹¿å‘Š, desc = true: å¼€å¯; false: å…³é—­;
# ä¿®æ”¹ç‚¹1ï¼šå¼€å…³æ–‡æ¡ˆæŒ‰ä½ è¦æ±‚è°ƒæ•´ï¼Œå¹¶è®¾ç½®é»˜è®¤å€¼ä¸º "true"
iPadDmFix=switch,"true","false",tag = [iPadå¼¹å¹•ä¿®å¤]ä¿®å¤iPadå¼¹å¹•æ˜¾ç¤º, desc = true: å¼€å¯ä¿®å¤(å¼¹å¹•æ­£å¸¸); false: å…³é—­ä¿®å¤(å¯èƒ½æ— å¼¹å¹•);
logLevel=select, "error", "warn", "info", "debug", "off",tag = æ—¥å¿—ç­‰çº§, desc = é€‰æ‹©æ—¥å¿—è¾“å‡ºç­‰çº§

[Rule]
DOMAIN,bsbsb.top,PROXY
# é˜»æ­¢Bç«™å¤‡ç”¨åŸŸåè®¿é—®
DOMAIN,api.biliapi.com,REJECT
DOMAIN,app.biliapi.com,REJECT
DOMAIN,api.biliapi.net,REJECT
DOMAIN,app.biliapi.net,REJECT
AND,((DOMAIN-SUFFIX,chat.bilibili.com),(OR,((DOMAIN-KEYWORD,stun),(DOMAIN-KEYWORD,tracker)))),REJECT

[Rewrite]
# ... [æ­¤å¤„æ‰€æœ‰Rewriteè§„åˆ™ä¸åŸå§‹é…ç½®å®Œå…¨ç›¸åŒï¼Œå·²çœç•¥ä»¥ä¿æŒç®€æ´] ...
# ç§»é™¤ç›´æ’­å¹¿å‘Š
^https:\/\/api\.live\.bilibili\.com\/xlive\/e-commerce-interface\/v1\/ecommerce-user\/get_shopping_info\? - reject-dict
# ... [å…¶ä»–è§„åˆ™] ...

[Script]
# ç©ºé™åŠ©æ‰‹
http-request ^https:\/\/(grpc\.biliapi\.net|app\.bilibili\.com)\/bilibili\.community\.service\.dm\.v1\.DM\/DmSegMobile$ script-path=https://raw.githubusercontent.com/kokoryh/Sparkle/master/dist/bilibili.protobuf.request.js, requires-body=true, binary-body-mode=true, timeout=10, tag=[å“”å“©å“”å“©]ç©ºé™åŠ©æ‰‹, enable={sponsorBlock}, argument=[{logLevel}]

http-request ^https:\/\/(grpc\.biliapi\.net|app\.bilibili\.com)\/bilibili\.(app\.viewunite\.v1\.View\/View|main\.community\.reply\.v1\.Reply\/MainList)$ script-path=https://raw.githubusercontent.com/kokoryh/Sparkle/master/dist/bilibili.protobuf.request.js, requires-body=true, binary-body-mode=true, timeout=10, tag=[å“”å“©å“”å“©]ProtoBuf Request, enable={optimizeRequest}, argument="[{purifyComment},{logLevel}]"

# ProtoBufå¤„ç† - æ‹†åˆ†è§‚çœ‹è¿›åº¦æ¥å£
# ä¿®æ”¹ç‚¹2ï¼šè§„åˆ™1æ²¿ç”¨å·²è¯å®æœ‰æ•ˆçš„ `enable` å‚æ•°
http-response ^https:\/\/(grpc\.biliapi\.net|app\.bilibili\.com)\/bilibili\.app\.view\.v1\.View\/ViewProgress$ script-path=https://raw.githubusercontent.com/kokoryh/Sparkle/master/dist/bilibili.protobuf.response.js, requires-body=true, binary-body-mode=true, tag=[å“”å“©å“”å“©]è§‚çœ‹è¿›åº¦, enable={iPadDmFix}, argument="[{displayUpList},{purifyComment},{sponsorBlock},{logLevel}]"

# è§„åˆ™2ï¼šå…¶ä»–æ‰€æœ‰æ¥å£ï¼ˆä»åŸè§„åˆ™ä¸­ç§»é™¤ViewProgressï¼‰
http-response ^https:\/\/(grpc\.biliapi\.net|app\.bilibili\.com)\/bilibili\.(app\.(show\.v1\.Popular\/Index|dynamic\.v2\.Dynamic\/DynAll|view(unite)?\.v1\.View\/(View|RelatesFeed)|playurl\.v1\.PlayURL\/PlayView|playerunite\.v1\.Player\/PlayViewUnite)|polymer\.app\.search\.v1\.Search\/SearchAll|community\.service\.dm\.v1\.DM\/DmView|main\.community\.reply\.v1\.Reply\/MainList|pgc\.gateway\.player\.v2\.PlayURL\/PlayView)$ script-path=https://raw.githubusercontent.com/kokoryh/Sparkle/master/dist/bilibili.protobuf.response.js, requires-body=true, binary-body-mode=true, tag=[å“”å“©å“”å“©]ProtoBuf Response, argument="[{displayUpList},{purifyComment},{sponsorBlock},{logLevel}]"

[MITM]
hostname = grpc.biliapi.net, app.bilibili.com, api.bilibili.com, api.live.bilibili.com, line3-h5-mobile-api.biligame.com
